!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";let t=new Object;t={$:jQuery,action:{toast:null,cart:null},api:{event:null}},window.addonifyFloatingCart=t;const e=addonifyFloatingCartJSObject.ajax_url,o=addonifyFloatingCartJSObject.nonce,a=addonifyFloatingCartJSObject.ajax_refresh_cart_fragments,n=addonifyFloatingCartJSObject.ajax_update_cart_item_action,i=addonifyFloatingCartJSObject.ajax_remove_from_cart_action,r=addonifyFloatingCartJSObject.ajax_restore_in_cart_action,d="1"===addonifyFloatingCartJSObject.open_cart_modal_immediately_after_add_to_cart,c="1"===addonifyFloatingCartJSObject.open_cart_modal_after_click_on_view_cart,s="1"===addonifyFloatingCartJSObject.openCartModalOnTriggerButtonHover,l="1"===addonifyFloatingCartJSObject.hideTriggerButtonIfCartIsEmpty,p="1"===addonifyFloatingCartJSObject.addonifyFloatingCartNotifyShow,f=addonifyFloatingCartJSObject.addonifyFloatingCartNotifyDuration,u="1"===addonifyFloatingCartJSObject.addonifyFloatingCartNotifyDismissible,_=addonifyFloatingCartJSObject.toast_notification_display_position.split("-"),h="1"===addonifyFloatingCartJSObject.displayToastNotificationButton,m=addonifyFloatingCartJSObject.addonifyFloatingCartNotifyMessage,g=addonifyFloatingCartJSObject.toastNotificationButton,y=addonifyFloatingCartJSObject.ajax_apply_coupon,w=addonifyFloatingCartJSObject.ajax_remove_coupon,v=addonifyFloatingCartJSObject.updateShippingInfo,C=addonifyFloatingCartJSObject.states;function b(t){if(!t)throw new Error("Spinner action is required!");const e=document.getElementById("adfy__woofc-spinner-container");e&&("show"===t?(e.classList.add("visible"),e.classList.remove("hidden")):(e.classList.add("hidden"),e.classList.remove("visible")))}addonifyFloatingCartJSObject.hideCartOnOverlayClicked;const{$:E,action:F,api:O}=t;const S=async()=>{b("show");try{const{fragments:n}=await E.ajax({type:"POST",dataType:"json",url:e,data:{action:a,nonce:o}});if(!n)throw new Error("Fragments not fetched! aborting...");return E.each(n,(function(t,e){E(t).replaceWith(e)})),E(document).trigger("wc_update_cart"),t.api.event.cartUpdated(n),n}catch(t){return console.error(t),t}finally{b("hide")}},{$:j,api:k}=t;const{action:x}=t;const{$:M}=t;function T(t){if(!t)throw new Error("Function [setShoppingMeterVisibility] requires action!");const e=M("#adfy__floating-cart .adfy__woofc-shipping-bar");e.length>0&&("hide"===t?e.addClass("adfy__woofc-hidden"):e.removeClass("adfy__woofc-hidden"))}function J(t){if(!t)throw new Error("Function [setTriggerButtonVisibility] requires action!");const e=document.getElementById("adfy__woofc-trigger");e&&e.hasAttribute("data_display")&&("hide"===t?e.setAttribute("data_display","hidden"):e.setAttribute("data_display","visible"))}const{$:q}=t;function A(){q(document).on("click",".adfy__woofc-prevent-default",(function(t){t.preventDefault()})),q(document).on("click",".adfy__show-woofc",(function(e){t.action.cart.open(e)})),q(document).on("mouseover",".adfy__show-woofc",(function(e){s&&t.action.cart.open(e)})),q(document).on("click",".added_to_cart.wc-forward",(function(e){c&&(e.preventDefault(),t.action.cart.open(e))})),q(document).on("click",".adfy__hide-woofc",(function(e){e.preventDefault(),t.action.cart.close(e)})),document.addEventListener("addonifyFloatingCartUpdated",(()=>{(()=>{const e=M("#adfy__floating-cart .adfy__woofc-shipping-bar .progress-bars .live-progress-bar");e&&(parseInt(e.attr("data_percentage"))>=100?(e.addClass("hide-animation"),t.api.event.shoppingMeterThresholdReached()):e.removeClass("hide-animation"))})()})),document.addEventListener("addonifyFloatingCartItemRestored",(()=>{l&&J("show")}))}const{$:D}=t;let U;function L(t="hide",e="info",o=""){const a=D("#adfy__floating-cart #adfy__woofc-cart-errors"),n=()=>{U&&clearTimeout(U),a.hasClass("error")&&a.removeClass("error"),a.html(" ").addClass("hidden")};"hide"===t?n():o.length>0&&(U&&clearTimeout(U),"error"===e&&a.addClass("error"),a.html(" ").html(o).removeClass("hidden"),U=setTimeout((()=>n()),1e4))}function R(t,e=null){if(!t)throw new Error("Coupon alert action is required!");let o=D("#adfy__floating-cart .adfy__woofc-alert");const a=()=>{let t;clearTimeout(t),t=setTimeout((()=>{D(o).fadeOut(),clearTimeout(t)}),1e4)};if("hide"!==t){if(o.length>0){const t={success:'<svg fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>',error:'<svg fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>'};if(!e)throw new Error("Coupon alert data is required!");const{style:o,message:n}=e;if(!o||!n)throw new Error("Coupon alert style & message is required!");let i;switch(o){case"success":i=`<p class="adfy__woofc-alert-text">\n                        ${t.success}\n                        ${n}\n                    </p>`,D(".adfy__woofc-alert.success").html(" ").html(i).fadeIn(),a();break;case"error":i=`<p class="adfy__woofc-alert-text">\n                        ${t.error}\n                        ${n}\n                    </p>`,D(".adfy__woofc-alert.error").html(" ").html(i).fadeIn(),a()}}}else a()}function I(t="hide",e=null){if("string"!=typeof t)throw new Error("Colophon visibility must be a string value.");const o=document.querySelector(".adfy__woofc-colophon"),a=document.querySelector(".adfy__woofc-cart-summary ul li.discount"),n=document.querySelector(".adfy__woofc-cart-summary ul li.sub-total"),i="adfy__woofc-hidden";if(o&&("show"===t?o.classList.remove(i):o.classList.add(i)),o&&"show"===t){const{discountVisibility:t,subTotalVisibility:o}=e;a&&t&&("show"===t?a.classList.remove(i):a.classList.add(i)),n&&("show"===o?n.classList.remove(i):n.classList.add(i))}}const{$:P}=t;function N(){P(document).on("added_to_cart",(function(e,o){e.preventDefault(),d&&t.action.cart.open(e),l&&J("show"),p&&function(e){if(!e||"object"!=typeof e)throw new Error("Toast message data invalid!");if(e&&"object"==typeof e){let o,a;a=Object.hasOwn(e,"product")?e.product.charAt(0).toUpperCase()+e.product.slice(1):__("Product","addonify-floating-cart"),o=h?m.replace("{product_name}",a)+" "+g:m.replace("{product_name}",a),t.action.toast.dispatch("success",o)}}(o),L("hide"),T("show"),I("show",{discountVisibility:"show",subTotalVisibility:"show"}),t.api.event.cartUpdated(o)})),P(document).on("wc_cart_emptied",(function(e){l&&J("hide"),T("hide"),I("hide"),t.api.event.cartUpdated(e)}))}const $=()=>{const t=document.getElementById("adfy__woofc-scrollbar"),e=t.classList.contains("ps");t&&!e&&new PerfectScrollbar(t,{wheelSpeed:1,wheelPropagation:!0,minScrollbarLength:20})},{$:B}=t,{__:V}=wp.i18n;function W(a,i,r=1){if(!a)throw new Error("Function [updateCartViaAjax] requires current element!");if(!i)throw new Error("Function [updateCartViaAjax] requires action!");let d;switch(i){case"add":d=B(a).next();break;case"sub":d=B(a).prev();break;default:d=B(a)}let c=B(a).attr("data-product_id"),s=B(a).attr("data-cart_item_key"),l=B(a).parents(".adfy__woofc-item");b("show"),B.ajax({type:"POST",dataType:"json",url:e,data:{action:n,product_id:c,cart_item_key:s,nonce:o,type:i,quantity:r},success:function(e){if(!e||e.error)throw new Error("Error updating cart via AJAX!");let o=e.fragments;o&&B.each(o,(function(t,e){B(t).replaceWith(e)}));let a=e.nQuantity;"OoS"===a?(alert("Out of stock range"),d.val(a)):"nil"!==a&&d.val(a),l.find(B(".adfy__woofc-item-price-multiplier-quantity")).html(a),l.unblock(),B(document.body).trigger("wc_update_cart"),t.api.event.cartUpdated(e)},error:function(e){const{__:o}=wp.i18n,a=o("Error processing cart update request!","addonify-floating-cart");throw t.action.toast.dispatch("error",a),new Error(e)},complete:function(){b("hide")}})}const{$:z}=t;const{$:Q}=t;function H(){Q(document).on("click","#adfy__woofc-shipping-trigger",(function(e){e.preventDefault(),Q("#adfy__woofc-shipping-container").attr("data_display","visible"),t.api.event.shippingModalOpened()})),Q(document).on("click","#adfy__woofc-hide-shipping-container",(function(e){e.preventDefault(),Q("#adfy__woofc-shipping-container").attr("data_display","hidden"),t.api.event.shippingModalClosed()})),Q(document).on("click","#adfy__woofc-shipping-form .adfy__woofc-shipping-address-form-toggle-button",(function(t){t.preventDefault(),"none"===Q(".adfy__woofc-shipping-form-elements").css("display")?Q(".adfy__woofc-shipping-form-elements").show():Q(".adfy__woofc-shipping-form-elements").hide()})),Q(document).on("change","#addonify_floating_cart_shipping_country",(function(t){let e=Q(this).val(),o=Q("#addonify_floating_cart_shipping_state"),a=C[e];if(o.siblings("span.select2").remove(),"object"==typeof a&&Object.keys(a).length>0){let t="";for(let e in a)t+='<option value="'+e+'">'+a[e]+"</option>";if("input"===o.prop("tagName").toLowerCase()){let t=o.parent();o.remove();let e=Q(document.createElement("select"));e.addClass("state_select").prop("id","addonify_floating_cart_shipping_state").prop("name","addonify_floating_cart_shipping_state"),e.prop("data-placeholder","State / County"),t.append(e)}Q("#addonify_floating_cart_shipping_state").html(t)}else if(a instanceof Array&&0===a.length){let t=o.parent();o.remove();let e=Q(document.createElement("input"));e.addClass("input_text").prop("id","addonify_floating_cart_shipping_state").prop("name","addonify_floating_cart_shipping_state"),e.prop("type","hidden"),t.append(e)}else{let t=o.parent();o.remove();let e=Q(document.createElement("input"));e.addClass("input_text").prop("id","addonify_floating_cart_shipping_state").prop("name","addonify_floating_cart_shipping_state"),e.prop("placeholder","State / County"),t.append(e)}}))}function X(){Q(document).on("submit","#adfy__woofc-shipping-form",(function(o){o.preventDefault();let a=Q("#addonify_floating_cart_shipping_country").val(),n=Q("#addonify_floating_cart_shipping_state").val(),i=Q("#addonify_floating_cart_shipping_city").val(),r=Q("#addonify_floating_cart_shipping_postcode").val(),d=Q("#addonify-floating-cart-shipping-nonce").val();const{__:c}=wp.i18n;let s=c("Error updating shipping address!.","addonify-floating-cart");Q.ajax({url:e,method:"POST",data:{action:v,calc_shipping_country:a,calc_shipping_state:n,calc_shipping_city:i,calc_shipping_postcode:r,nonce:d},success:function(e){e?e.fragments&&(Q.each(e.fragments,(function(t,e){""!==e?Q(t).replaceWith(e):Q(t).html(e)})),t.api.event.shippingAddressUpdated(e.fragments)):t.action.toast.dispatchToast("error",s)},error:function(e){console.log(e),t.action.toast.dispatchToast("error",s)}})}))}function G(){Q(document).on("change",".shipping_method",(function(a){const{__:n}=wp.i18n;let i=new Object,r=n("Error processing shipping method update request.","addonify-floating-cart");Q("select.shipping_method, :input[name^=shipping_method][type=radio]:checked, :input[name^=shipping_method][type=hidden]").each((function(){i[Q(this).data("index")]=Q(this).val()})),b("hide"),Q.ajax({url:e,method:"POST",data:{action:v,nonce:o,shipping_method:i},success:function(e){if(!e||e.error)return void t.action.toast.dispatch("error",r);let o=e.fragments;o&&Q.each(o,(function(t,e){""!==e?Q(t).replaceWith(e):Q(t).html(e)}))},error:function(e){console.log(e),t.action.toast.dispatch("error",r)},complete:function(){b("hide")}})}))}document.addEventListener("DOMContentLoaded",(function(){(()=>{if("function"!=typeof PerfectScrollbar)return void console.warn("Info: Addonify Floating Cart, PerfectScrollbar is not defined. Perfect scroll bar won't be initialized.");const t=document.getElementById("adfy__floating-cart");new MutationObserver((t=>{t.length>0&&$()})).observe(t,{attributes:!1,childList:!0,subtree:!0})})()})),function(a){F.cart={open:t=>{t.preventDefault(),E("body").addClass("adfy__woofc-visible"),O.event.cartOpened(t)},close:t=>{t.preventDefault(),E("body").removeClass("adfy__woofc-visible"),O.event.cartClosed(t)},refresh:()=>{S()}},k.event={cartOpened:t=>{j(document).trigger("addonifyFloatingCartOpened"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartOpened"))},cartClosed:t=>{j(document).trigger("addonifyFloatingCartClosed"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartClosed"))},cartUpdated:t=>{j(document).trigger("addonifyFloatingCartUpdated",t),document.dispatchEvent(new CustomEvent("addonifyFloatingCartUpdated",{detail:t}))},cartEmptied:()=>{j(document).trigger("addonifyFloatingCartEmptied"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartEmptied")),j(document).trigger("wc_cart_emptied")},productRemoved:e=>{j(document).trigger("addonifyFloatingCartProductRemoved",e),document.dispatchEvent(new CustomEvent("addonifyFloatingCartProductRemoved",{detail:e})),t.api.event.cartUpdated(data)},productRestored:e=>{j(document).trigger("addonifyFloatingCartProductRestored",e),document.dispatchEvent(new CustomEvent("addonifyFloatingCartProductRestored",{detail:e})),t.api.event.cartUpdated(e)},couponModalOpened:()=>{j(document).trigger("addonifyFloatingCartCouponModalOpened"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartCouponModalOpened"))},couponModalClosed:()=>{j(document).trigger("addonifyFloatingCartCouponModalClosed"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartCouponModalClosed"))},couponApplied:e=>{j(document).trigger("addonifyFloatingCartCouponApplied",e),document.dispatchEvent(new CustomEvent("addonifyFloatingCartCouponApplied",{detail:e})),t.api.event.cartUpdated(e)},couponRemoved:e=>{j(document).trigger("addonifyFloatingCartCouponRemoved",e),document.dispatchEvent(new CustomEvent("addonifyFloatingCartCouponRemoved",{detail:e})),t.api.event.cartUpdated(e)},shippingModalOpened:()=>{j(document).trigger("addonifyFloatingCartShippingModalOpened"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartShippingModalOpened"))},shippingModalClosed:()=>{j(document).trigger("addonifyFloatingCartShippingModalClosed"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartShippingModalClosed"))},shippingAddressUpdated:e=>{j(document).trigger("addonifyFloatingCartShippingAddressUpdated",e),document.dispatchEvent(new CustomEvent("addonifyFloatingCartShippingAddressUpdated",{detail:e})),t.api.event.cartUpdated(e)},shoppingMeterThresholdReached:()=>{j(document).trigger("addonifyFloatingCartShoppingMeterThresholdReached"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartShoppingMeterThresholdReached"))}},x.toast={dispatch:(t="success",e)=>{if("undefined"!=typeof Notyf){let o=new Notyf({duration:f,dismissible:u,ripple:!0,position:{x:_[1],y:_[0]}});if(!e)throw new Error("Notification toast data/message is empty, bailing out...");"error"===t&&o.error({className:"adfy__woofc-notfy-error",message:e}),p&&"success"===t&&o.success({className:"adfy__woofc-notfy-success",message:e})}}},a(document).ready((function(){S(),A(),N(),B(document).on("click",".adfy__woofc-item .adfy__woofc-inc-quantity",(function(t){t.preventDefault();const e=B(this).prev();(parseInt(e.val())<parseInt(e.attr("max"))||""===e.attr("max"))&&W(this,"add")})),B(document).on("click",".adfy__woofc-item .adfy__woofc-dec-quantity",(function(t){t.preventDefault();const e=B(this).next();parseInt(e.val())<=parseInt(e.attr("min"))||W(this,"sub")})),B(document).on("change",".adfy__woofc-item .adfy__woofc-quantity-input-field",(function(t){t.preventDefault(),W(this,"update",B(this).val())})),B(document).on("click",".adfy__woofc-item .thumb .product-remove",(function(a){a.preventDefault();const n=B(this).attr("data-product_id"),r=B(this).attr("data-cart_item_key"),d=B(this);b("show"),B.ajax({type:"POST",dataType:"json",url:e,data:{action:i,product_id:n,cart_item_key:r,nonce:o},success:function(e){if(!e||e.error)throw new Error("Error removing product from cart!");B(".post-"+n).find("a.wc-forward").remove(),B(".post-"+n).find("a.add_to_cart_button").removeClass("added");let o=e.fragments;o&&B.each(o,(function(t,e){B(t).replaceWith(e)})),L("show","info",e.undo_product_link),0===e.cart_items_count&&(t.api.event.cartEmptied(),B(".adfy__woofc-content-entry").html(e.empty_cart_message)),B(document).trigger("removed_from_cart",[e.fragments,e.cart_hash,d]),B(document).trigger("wc_update_cart"),t.api.event.cartUpdated(e)},error:function(e){console.log(e);const o=V("Error processing product removal request!","addonify-floating-cart");t.action.toast.dispatch("error",o)},complete:function(){b("hide")}})})),B(document).on("click","#adfy__woofc_restore_item",(function(a){a.preventDefault();const n=B(this).attr("data-item_key");b("show"),B.ajax({type:"POST",dataType:"json",url:e,data:{action:r,cart_item_key:n,nonce:o},success:function(e){if(!e.fragments||e.error)throw new Error("Error restoring product to cart!");const o=e.fragments,a=B(".adfy__woofc-colophon"),n=B(".adfy__woofc-shipping-bar");o&&B.each(o,(function(t,e){B(t).replaceWith(e)})),a.hasClass("adfy__woofc-hidden")&&a.removeClass("adfy__woofc-hidden"),n.hasClass("adfy__woofc-hidden")&&n.removeClass("adfy__woofc-hidden"),t.api.event.productRestored(o),L("hide")},error:function(e){console.log(e);const o=V("Error processing product restore request!","addonify-floating-cart");t.action.toast.dispatch("error",o)},complete:function(){b("hide")}})})),function(){const e=z("#adfy__woofc-coupon-container");z(document).on("click","#adfy__woofc-coupon-trigger",(function(o){o.preventDefault(),e.attr("data_display","visible"),t.api.event.couponModalOpened()})),z(document).on("click","#adfy__woofc-hide-coupon-container",(function(o){o.preventDefault(),e.attr("data_display","hidden"),t.api.event.couponModalClosed()}))}(),function(){const{__:a}=wp.i18n;let n;z(document).on("submit","#adfy__woofc-coupon-form",(function(i){i.preventDefault();let r=z(this).find("input[name=adfy__woofc-coupon-input-field]"),d=r.val();z.ajax({url:e,method:"post",data:{action:y,nonce:o,form_data:d},success:function(e){let o=JSON.parse(e);if(!o)return n=a("Error processing coupon request.","addonify-floating-cart"),void R("show",{style:"error",message:n});const{appliedCoupons:i,couponApplied:d,html:c,status:s}=o,l=z(".adfy__woofc-cart-summary ul li.sub-total"),p=z(".adfy__woofc-cart-summary ul li.discount");d?d&&(r.val(""),z.each(c,(function(t,e){z(t).replaceWith(e)})),R("show",{style:"success",message:s}),t.api.event.couponApplied(o),i>0&&(l.removeClass("adfy__woofc-hidden"),p.removeClass("adfy__woofc-hidden"))):R("show",{style:"error",message:s})},error:function(e){console.log(e),n=a("Error processing coupon request.","addonify-floating-cart"),t.action.toast.dispatch("error",n),R("show",{style:"error",message:n})}})}))}(),function(){const{__:a}=wp.i18n;let n;z(document).on("click",".adfy__woofc-remove-applied-coupon-button",(function(i){i.preventDefault();let r=z(this).closest("li"),d=z(this).attr("data-coupon");z.ajax({url:e,method:"post",data:{action:w,nonce:o,form_data:d},success:function(e){let o=JSON.parse(e);if(!o)return n=a("Error processing coupon request.","addonify-floating-cart"),void R("show",{style:"error",message:n});const{appliedCoupons:i,couponRemoved:d,html:c,status:s}=o;if(d){const e=z(".adfy__woofc-cart-summary ul li.sub-total"),a=z(".adfy__woofc-cart-summary ul li.discount");z.each(c,(function(t,e){z(t).replaceWith(e)})),R("show",{style:"success",message:s}),r.remove(),t.api.event.couponRemoved(o),i>0&&(e.removeClass("adfy__woofc-hidden"),a.removeClass("adfy__woofc-hidden"))}},error:function(t){console.log(t),n=a("Error processing coupon request.","addonify-floating-cart"),R("show",{style:"error",message:n})}})}))}(),H(),X(),G()}))}(jQuery)}));
